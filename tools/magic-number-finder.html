<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
  <title>Magic Number Finder</title>
  <meta name="theme-color" content="#7c3aed">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <style>
    * { -webkit-tap-highlight-color: transparent; }
    html, body, #root { height: 100%; margin: 0; overflow: hidden; }
    .allow-scroll { overflow: auto !important; }

    @keyframes mystical-glow {
      0%, 100% { box-shadow: 0 0 20px rgba(147, 51, 234, 0.5); }
      50% { box-shadow: 0 0 40px rgba(147, 51, 234, 0.8), 0 0 60px rgba(236, 72, 153, 0.4); }
    }

    @keyframes float {
      0%, 100% { transform: translateY(0); }
      50% { transform: translateY(-5px); }
    }

    .mystical-card {
      animation: mystical-glow 3s ease-in-out infinite;
    }

    .floating {
      animation: float 3s ease-in-out infinite;
    }

    .stars {
      background-image:
        radial-gradient(2px 2px at 20px 30px, white, transparent),
        radial-gradient(2px 2px at 40px 70px, rgba(255,255,255,0.8), transparent),
        radial-gradient(1px 1px at 90px 40px, white, transparent),
        radial-gradient(2px 2px at 130px 80px, rgba(255,255,255,0.6), transparent),
        radial-gradient(1px 1px at 160px 20px, white, transparent);
      background-repeat: repeat;
      background-size: 200px 100px;
    }
  </style>
</head>
<body>
  <div id="root"></div>
  <script type="text/babel">
    const { useState, useEffect, useMemo } = React;

// localStorage helpers
const STORAGE_KEY = 'magic-number-finder-history';

function loadHistory() {
  try {
    const data = localStorage.getItem(STORAGE_KEY);
    return data ? JSON.parse(data) : [];
  } catch { return []; }
}

function saveToHistory(numbers) {
  const history = loadHistory();
  const entry = {
    id: Date.now(),
    numbers,
    date: new Date().toLocaleDateString(),
    preview: numbers.slice(0, 4).join(', ') + (numbers.length > 4 ? '...' : '')
  };
  const isDuplicate = history.some(h => JSON.stringify(h.numbers) === JSON.stringify(numbers));
  if (!isDuplicate) {
    history.unshift(entry);
    if (history.length > 10) history.pop();
    localStorage.setItem(STORAGE_KEY, JSON.stringify(history));
  }
}

function deleteFromHistory(id) {
  const history = loadHistory().filter(h => h.id !== id);
  localStorage.setItem(STORAGE_KEY, JSON.stringify(history));
}

// The sacred constants and cosmic measurements
const MAGIC_NUMBERS = [
  // Mathematical constants
  { value: Math.PI, name: 'Pi', symbol: 'Ï€', category: 'mathematical', description: 'The ratio of a circle\'s circumference to its diameter' },
  { value: (1 + Math.sqrt(5)) / 2, name: 'Golden Ratio', symbol: 'Ï†', category: 'mathematical', description: 'The divine proportion found throughout nature' },
  { value: Math.E, name: 'Euler\'s Number', symbol: 'e', category: 'mathematical', description: 'The base of natural logarithms' },
  { value: Math.sqrt(2), name: 'Pythagoras\' Constant', symbol: 'âˆš2', category: 'mathematical', description: 'The diagonal of a unit square' },
  { value: Math.sqrt(3), name: 'Theodorus\' Constant', symbol: 'âˆš3', category: 'mathematical', description: 'Sacred to ancient geometers' },
  { value: Math.sqrt(5), name: 'Root of Five', symbol: 'âˆš5', category: 'mathematical', description: 'Hidden within the Golden Ratio' },

  // Astronomical measurements
  { value: 299792458, name: 'Speed of Light', symbol: 'c', category: 'cosmic', description: 'Meters per second - the universe\'s speed limit' },
  { value: 149597870.7, name: 'Earth-Sun Distance', symbol: 'AU', category: 'cosmic', description: 'Kilometers - one Astronomical Unit' },
  { value: 384400, name: 'Earth-Moon Distance', symbol: 'ðŸŒ™', category: 'cosmic', description: 'Kilometers average' },
  { value: 6371, name: 'Earth\'s Radius', symbol: 'ðŸŒ', category: 'cosmic', description: 'Kilometers' },
  { value: 1737, name: 'Moon\'s Radius', symbol: 'ðŸŒ‘', category: 'cosmic', description: 'Kilometers' },
  { value: 696340, name: 'Sun\'s Radius', symbol: 'â˜€ï¸', category: 'cosmic', description: 'Kilometers' },
  { value: 365.25, name: 'Days in Year', symbol: 'ðŸ“…', category: 'cosmic', description: 'Earth\'s orbital period' },
  { value: 27.3, name: 'Lunar Cycle', symbol: 'ðŸŒ•', category: 'cosmic', description: 'Days - sidereal month' },
  { value: 29.5, name: 'Synodic Month', symbol: 'ðŸŒ“', category: 'cosmic', description: 'Days between full moons' },

  // Sacred architecture
  { value: 146.6, name: 'Great Pyramid Height', symbol: 'â–³', category: 'ancient', description: 'Meters - original height' },
  { value: 230.4, name: 'Great Pyramid Base', symbol: 'â–¢', category: 'ancient', description: 'Meters per side' },
  { value: 51.84, name: 'Pyramid Angle', symbol: 'âˆ ', category: 'ancient', description: 'Degrees - slope angle' },
  { value: 2.72, name: 'Cubit', symbol: 'ðŸ“', category: 'ancient', description: 'Royal Egyptian cubit in feet' },

  // Sacred numbers
  { value: 108, name: 'Sacred 108', symbol: 'ðŸ•‰ï¸', category: 'mystical', description: 'Sun/Moon distance ratio, holy in Eastern traditions' },
  { value: 432, name: 'Cosmic Frequency', symbol: 'ðŸŽµ', category: 'mystical', description: 'Hz - the "natural" tuning, Sun radius = 432,000 mi' },
  { value: 144, name: 'Gross/Square of 12', symbol: 'â¬¡', category: 'mystical', description: '12Ã—12 - sacred in many traditions' },
  { value: 666, name: 'Number of the Beast', symbol: 'ðŸ‘¹', category: 'mystical', description: 'Biblical number of significance' },
  { value: 888, name: 'Jesus Number', symbol: 'âœï¸', category: 'mystical', description: 'Greek gematria value of "Jesus"' },
  { value: 137, name: 'Fine Structure', symbol: 'Î±', category: 'mystical', description: '1/Î± - the "magic number" of physics' },
  { value: 7, name: 'Lucky Seven', symbol: '7ï¸âƒ£', category: 'mystical', description: 'Days of creation, chakras, deadly sins' },
  { value: 12, name: 'Cosmic Twelve', symbol: 'ðŸ”¯', category: 'mystical', description: 'Zodiac signs, apostles, months' },
  { value: 13, name: 'Sacred Thirteen', symbol: 'ðŸŒ€', category: 'mystical', description: 'Lunar months, Mayan sacred number' },
  { value: 40, name: 'Biblical Forty', symbol: 'ðŸ“œ', category: 'mystical', description: 'Days of flood, years in desert' },
  { value: 72, name: 'Precessional Degree', symbol: 'âœ¡ï¸', category: 'mystical', description: 'Years per degree of precession, Names of God' },
  { value: 360, name: 'Full Circle', symbol: 'â­•', category: 'mystical', description: 'Degrees - Babylonian sacred number' },

  // Precessional / Sacred Geometry (Carlson-style)
  { value: 25920, name: 'Great Year', symbol: 'ðŸŒ€', category: 'ancient', description: 'Years for full precession of equinoxes' },
  { value: 2160, name: 'Zodiac Age', symbol: 'â™ˆ', category: 'ancient', description: 'Years per age, also Moon diameter in miles' },
  { value: 43200, name: 'Pyramid Scale', symbol: 'ðŸ”º', category: 'ancient', description: 'Great Pyramid to Earth ratio, half of 86,400' },
  { value: 86400, name: 'Seconds per Day', symbol: 'â±ï¸', category: 'cosmic', description: 'Seconds in 24 hours' },
  { value: 432000, name: 'Solar Radius', symbol: 'â˜€ï¸', category: 'cosmic', description: 'Approximate radius of the Sun in miles' },
  { value: 1080, name: 'Moon Radius', symbol: 'ðŸŒ™', category: 'cosmic', description: 'Moon radius in miles (108 Ã— 10)' },
  { value: 3960, name: 'Earth Radius Mi', symbol: 'ðŸŒ', category: 'cosmic', description: 'Earth radius in miles' },

  // Physical constants
  { value: 9.81, name: 'Earth Gravity', symbol: 'g', category: 'physics', description: 'Gravitational acceleration (m/sÂ²)' },
  { value: 6.674, name: 'Gravitational Constant', symbol: 'G', category: 'physics', description: 'Ã—10â»Â¹Â¹ - Newton\'s constant' },
  { value: 1.618033988749, name: 'Phi Precise', symbol: 'Î¦', category: 'mathematical', description: 'Golden ratio to 12 decimals' },
];

// Key constants to use in equations
const PI = Math.PI;
const PHI = (1 + Math.sqrt(5)) / 2;
const E = Math.E;
const SQRT2 = Math.sqrt(2);
const SQRT3 = Math.sqrt(3);
const SQRT5 = Math.sqrt(5);

const EQUATION_CONSTANTS = [
  { value: PI, symbol: 'Ï€', name: 'Pi' },
  { value: PHI, symbol: 'Ï†', name: 'Golden Ratio' },
  { value: E, symbol: 'e', name: "Euler's Number" },
  { value: SQRT2, symbol: 'âˆš2', name: 'Root 2' },
  { value: SQRT3, symbol: 'âˆš3', name: 'Root 3' },
  { value: 7, symbol: '7', name: 'Sacred Seven' },
  { value: 12, symbol: '12', name: 'Cosmic Twelve' },
  { value: 72, symbol: '72', name: 'Precessional Degree' },
  { value: 108, symbol: '108', name: 'Sacred 108' },
  { value: 360, symbol: '360', name: 'Full Circle' },
  { value: 432, symbol: '432', name: 'Cosmic Frequency' },
  { value: 2160, symbol: '2160', name: 'Zodiac Age' },
  { value: 43200, symbol: '43200', name: 'Pyramid Scale' },
];

// Sacred ratios to check between numbers
const SACRED_RATIOS = [
  { value: 108, name: 'Sun/Moon Distance Ratio', description: 'The cosmic 108 appears in celestial distances' },
  { value: 43200, name: 'Pyramid Scale Factor', description: 'The Great Pyramid encodes Earth\'s dimensions' },
  { value: 12, name: 'Zodiac Division', description: 'The universe divided into 12 houses' },
  { value: 72, name: 'Precessional Slip', description: 'One degree every 72 years' },
];

// Explanations for symbols/constants used in equations
const SYMBOL_EXPLANATIONS = {
  'Ï€': { symbol: 'Ï€', name: 'Pi', explanation: 'Ratio of circle circumference to diameter (3.14159...)' },
  'Ï†': { symbol: 'Ï†', name: 'Golden Ratio', explanation: 'The divine proportion found in nature and art (1.618...)' },
  'e': { symbol: 'e', name: "Euler's Number", explanation: 'Base of natural logarithms (2.718...)' },
  'âˆš2': { symbol: 'âˆš2', name: 'Root 2', explanation: 'Diagonal of a unit square (1.414...)' },
  'âˆš3': { symbol: 'âˆš3', name: 'Root 3', explanation: 'Height of equilateral triangle (1.732...)' },
  '7': { symbol: '7', name: 'Sacred Seven', explanation: 'Days of creation, chakras, musical notes' },
  '12': { symbol: '12', name: 'Cosmic Twelve', explanation: 'Zodiac signs, apostles, months of the year' },
  '72': { symbol: '72', name: 'Precessional Degree', explanation: 'Years for Earth\'s axis to shift 1Â° (25,920 Ã· 360)' },
  '108': { symbol: '108', name: 'Sacred 108', explanation: 'Sun is 108Ã— its diameter from Earth; same for Moon' },
  '360': { symbol: '360', name: 'Full Circle', explanation: 'Degrees in a circle, Babylonian base-60 sacred number' },
  '432': { symbol: '432', name: 'Cosmic Frequency', explanation: 'Natural tuning Hz; Sun radius â‰ˆ 432,000 miles' },
  '2160': { symbol: '2160', name: 'Zodiac Age', explanation: 'Years per astrological age; Moon diameter in miles' },
  '43200': { symbol: '43200', name: 'Pyramid Scale', explanation: 'Scale factor linking Great Pyramid dimensions to Earth' },
};

// Find which constants appear in an equation string
function findConstantsInEquation(equation) {
  const found = [];
  // Sort by length descending so we check longer numbers first (43200 before 432, 72 before 7)
  const sortedEntries = Object.entries(SYMBOL_EXPLANATIONS).sort((a, b) => b[0].length - a[0].length);

  for (const [key, info] of sortedEntries) {
    // For numeric constants, ensure they're not part of a larger number
    const isNumeric = /^\d+$/.test(key);
    if (isNumeric) {
      // Match only if surrounded by non-digits (or start/end of string)
      const regex = new RegExp(`(^|[^0-9])${key}([^0-9]|$)`);
      if (regex.test(equation)) {
        found.push(info);
      }
    } else {
      // For symbols like Ï€, Ï†, âˆš2, just check if they appear
      if (equation.includes(key)) {
        found.push(info);
      }
    }
  }
  return found;
}

function findMagic(numbers) {
  const results = [];
  const tolerance = 0.005; // ~0.5% tolerance for direct matches
  const multiplesTolerance = 0.002; // tighter tolerance for multiples

  // Helper to check if a value is close to an integer or simple fraction
  function isNiceNumber(val) {
    if (!isFinite(val) || isNaN(val) || val === 0) return null;

    // Check against magic numbers (direct matches only - no multiples, they create noise)
    for (const magic of MAGIC_NUMBERS) {
      const error = Math.abs(val / magic.value - 1);
      if (error < tolerance) {
        return { value: magic.value, display: magic.symbol, name: magic.name, type: 'magic', error, magic };
      }
    }

    // Only check very precise multiples for the most important constants
    const keyConstants = [Math.PI, (1 + Math.sqrt(5)) / 2, Math.E];
    const keyMagic = MAGIC_NUMBERS.filter(m => keyConstants.some(k => Math.abs(m.value - k) < 0.0001));
    for (const magic of keyMagic) {
      for (const mult of [2, 10]) {
        const err2 = Math.abs(val / (magic.value * mult) - 1);
        if (err2 < multiplesTolerance) {
          return { value: magic.value * mult, display: `${mult} Ã— ${magic.symbol}`, name: `${mult} Ã— ${magic.name}`, type: 'magic', error: err2, magic };
        }
      }
    }
    return null;
  }

  // Generate equations between numbers using constants
  function tryEquation(equation, result, numCount, description, intermediateValue = null) {
    if (!isFinite(result) || isNaN(result)) return;

    // Skip trivial results where intermediate value is ~1 (meaning we just get the constant back)
    // This happens when numbers are close together and their ratio/sum â‰ˆ 1
    if (intermediateValue !== null) {
      const intAbs = Math.abs(intermediateValue);
      if (intAbs > 0.8 && intAbs < 1.25) return;
    }

    const nice = isNiceNumber(result);
    if (nice && nice.type === 'magic') {
      // Skip if the result essentially appears in the equation (circular results like "2 Ã— Ï€ = 2 Ã— Ï€")
      const resultPattern = nice.display.replace(/[.*+?^${}()|[\]\\]/g, '\\$&');
      const circularRegex = new RegExp(`(^|\\s|Ã—|Ã·|\\()${resultPattern}(\\s|Ã—|Ã·|\\)|$)`);
      if (circularRegex.test(equation)) return;

      results.push({
        equation,
        result: nice.display,
        resultName: nice.name,
        accuracy: ((1 - nice.error) * 100).toFixed(2),
        description,
        numbersInvolved: numCount,
        magic: nice.magic,
        mysteryLevel: numCount >= 4 ? 'ULTIMATE CONVERGENCE' :
                      numCount >= 3 ? 'TRANSCENDENT' :
                      nice.error < 0.001 ? 'INCREDIBLE' : 'DISCOVERED'
      });
    }
  }

  const n = numbers.length;

  // Single number analysis - always run for each number
  // These will be shown in a collapsed section when multi-number results exist
  for (let i = 0; i < n; i++) {
    const a = numbers[i];
    if (a === 0) continue;

    // Direct match check
    tryEquation(`${a}`, a, 1, 'A number of cosmic significance');

    // Single number with constants
    for (const c of EQUATION_CONSTANTS) {
      tryEquation(`${a} Ã— ${c.symbol}`, a * c.value, 1, `Multiplied by ${c.name}`, a);
      tryEquation(`${a} Ã· ${c.symbol}`, a / c.value, 1, `Divided by ${c.name}`, a / c.value);
      // Only add/subtract if the number is significant relative to the constant
      if (Math.abs(a) > c.value * 0.1) {
        tryEquation(`${a} + ${c.symbol}`, a + c.value, 1, `${c.name} added`);
        tryEquation(`${a} âˆ’ ${c.symbol}`, a - c.value, 1, `${c.name} subtracted`);
      }
      if (a > 1) {
        tryEquation(`${c.symbol} ^ ${a}`, Math.pow(c.value, a), 1, `${c.name} raised to this power`);
      }
    }

    // Square root, square, etc.
    tryEquation(`âˆš${a}`, Math.sqrt(a), 1, 'The square root reveals hidden truth');
    tryEquation(`${a}Â²`, a * a, 1, 'Squared, it transforms');
    if (a > 0 && a < 100) {
      tryEquation(`${a}Â³`, a * a * a, 1, 'Cubed, it ascends');
    }

    // Factorial for small numbers
    if (a > 0 && a <= 10 && Number.isInteger(a)) {
      let fact = 1;
      for (let j = 2; j <= a; j++) fact *= j;
      tryEquation(`${a}!`, fact, 1, 'Factorial unlocks deeper meaning');
    }

    // Precessional numbers and combined constants
    tryEquation(`${a} Ã· 12`, a / 12, 1, 'Divided by the Zodiac');
    tryEquation(`${a} Ã· 360`, a / 360, 1, 'Divided by the full circle');
    tryEquation(`${a} Ã— 72`, a * 72, 1, 'Precessional years amplify');
    tryEquation(`${a} Ã— 108`, a * 108, 1, 'Sacred 108 magnifies');
    tryEquation(`${a} Ã— Ï€ Ã— Ï†`, a * PI * PHI, 1, 'Pi and Phi together transform', a);
    tryEquation(`${a} Ã· (Ï€ Ã— Ï†)`, a / (PI * PHI), 1, 'Divided by the sacred product', a / (PI * PHI));
  }

  // Two-number relationships with constants
  if (n >= 2) {
    for (let i = 0; i < n; i++) {
      for (let j = 0; j < n; j++) {
        if (i === j) continue;
        const a = numbers[i], b = numbers[j];
        if (a === 0 || b === 0) continue;

        // Direct relationships
        tryEquation(`${a} Ã· ${b}`, a / b, 2, 'The ratio reveals a sacred proportion');
        tryEquation(`${a} Ã— ${b}`, a * b, 2, 'Their product unveils cosmic significance');
        tryEquation(`${a} + ${b}`, a + b, 2, 'United, they form a sacred sum');
        tryEquation(`${a} âˆ’ ${b}`, a - b, 2, 'Their difference echoes through the cosmos');

        // Sacred ratio checks (Carlson-style)
        for (const ratio of SACRED_RATIOS) {
          tryEquation(`${a} Ã· ${b} Ã— ${ratio.value}`, (a / b) * ratio.value, 2, ratio.description, a / b);
          tryEquation(`(${a} âˆ’ ${b}) Ã— ${ratio.value}`, (a - b) * ratio.value, 2, ratio.description, a - b);
        }

        // Precessional equations
        tryEquation(`${a} Ã— ${b} Ã· 12`, (a * b) / 12, 2, 'Divided by the Zodiac reveals hidden order');
        tryEquation(`${a} Ã— ${b} Ã· 360`, (a * b) / 360, 2, 'The full circle divides their product');
        tryEquation(`(${a} + ${b}) Ã— 72`, (a + b) * 72, 2, 'Precessional years amplify the sum');
        tryEquation(`(${a} + ${b}) Ã— 2160`, (a + b) * 2160, 2, 'A Zodiac Age magnifies their union');
        tryEquation(`${a} Ã— 43200 Ã· ${b}`, (a * 43200) / b, 2, 'The Pyramid Scale reveals Earth\'s encoding', a / b);

        // With constants - pass intermediate values to filter trivial results
        for (const c of EQUATION_CONSTANTS) {
          tryEquation(`(${a} + ${b}) Ã· ${c.symbol}`, (a + b) / c.value, 2, `Divided by ${c.name}, the sum transforms`, (a + b) / c.value);
          tryEquation(`(${a} + ${b}) Ã— ${c.symbol}`, (a + b) * c.value, 2, `Multiplied by ${c.name}, harmony emerges`, a + b);
          tryEquation(`(${a} Ã— ${b}) Ã· ${c.symbol}`, (a * b) / c.value, 2, `The product, scaled by ${c.name}`, (a * b) / c.value);
          tryEquation(`(${a} âˆ’ ${b}) Ã— ${c.symbol}`, (a - b) * c.value, 2, `Their difference, amplified by ${c.name}`, a - b);
          tryEquation(`${a} Ã· ${b} Ã— ${c.symbol}`, (a / b) * c.value, 2, `The ratio, blessed by ${c.name}`, a / b);
          tryEquation(`(${a} + ${b}) Ã· ${c.symbol}Â²`, (a + b) / (c.value * c.value), 2, `Divided by ${c.name} squared`, (a + b) / (c.value * c.value));
          tryEquation(`âˆš(${a} Ã— ${b}) Ã· ${c.symbol}`, Math.sqrt(a * b) / c.value, 2, `Their geometric mean divided by ${c.name}`, Math.sqrt(a * b) / c.value);
          tryEquation(`(${a}Â² + ${b}Â²) Ã· ${c.symbol}`, (a*a + b*b) / c.value, 2, `Sum of squares over ${c.name}`, (a*a + b*b) / c.value);
          tryEquation(`(${a} Ã— ${c.symbol}) Ã· ${b}`, (a * c.value) / b, 2, `${c.name} mediates between them`, a / b);
          tryEquation(`(${a} + ${c.symbol}) Ã· ${b}`, (a + c.value) / b, 2, `${c.name} joins one, divided by the other`);
        }

        // Double constants
        tryEquation(`(${a} Ã· ${b}) Ã— Ï€ Ã— Ï†`, (a / b) * PI * PHI, 2, 'Pi and Phi amplify their ratio', a / b);
        tryEquation(`(${a} + ${b}) Ã· (Ï€ Ã— Ï†)`, (a + b) / (PI * PHI), 2, 'The sacred product divides their sum', (a + b) / (PI * PHI));
        tryEquation(`(${a} Ã— ${b}) Ã· (Ï€ Ã— e)`, (a * b) / (PI * E), 2, 'Pi and e unlock their product', (a * b) / (PI * E));
        tryEquation(`âˆš(${a}Â² + ${b}Â²) Ã· Ï€`, Math.sqrt(a*a + b*b) / PI, 2, 'Pythagorean distance over Pi', Math.sqrt(a*a + b*b) / PI);
      }
    }
  }

  // Three-number relationships
  if (n >= 3) {
    for (let i = 0; i < n; i++) {
      for (let j = i + 1; j < n; j++) {
        for (let k = j + 1; k < n; k++) {
          const a = numbers[i], b = numbers[j], c = numbers[k];
          if (a === 0 || b === 0 || c === 0) continue;

          tryEquation(`${a} + ${b} + ${c}`, a + b + c, 3, 'The trinity combines');
          tryEquation(`${a} Ã— ${b} Ã— ${c}`, a * b * c, 3, 'Triple product reveals truth');
          tryEquation(`(${a} + ${b}) Ã— ${c}`, (a + b) * c, 3, 'Sum times third');
          tryEquation(`(${a} Ã— ${b}) + ${c}`, (a * b) + c, 3, 'Product plus third');
          tryEquation(`(${a} + ${b}) Ã· ${c}`, (a + b) / c, 3, 'Sum over third reveals proportion');
          tryEquation(`(${a} Ã— ${b}) Ã· ${c}`, (a * b) / c, 3, 'Product over third');
          tryEquation(`${a} Ã— ${b} Ã· ${c}`, a * b / c, 3, 'Chained division');
          tryEquation(`(${a} âˆ’ ${b}) Ã— ${c}`, (a - b) * c, 3, 'Difference amplified');

          for (const con of EQUATION_CONSTANTS.slice(0, 5)) {
            tryEquation(`(${a} + ${b} + ${c}) Ã· ${con.symbol}`, (a + b + c) / con.value, 3, `Trinity divided by ${con.name}`, (a + b + c) / con.value);
            tryEquation(`(${a} Ã— ${b} Ã— ${c}) Ã· ${con.symbol}`, (a * b * c) / con.value, 3, `Triple product over ${con.name}`, (a * b * c) / con.value);
            tryEquation(`(${a} + ${b}) Ã— ${c} Ã· ${con.symbol}`, (a + b) * c / con.value, 3, `Combined and scaled by ${con.name}`, (a + b) * c / con.value);
            tryEquation(`(${a} Ã— ${b} + ${c}) Ã— ${con.symbol}`, (a * b + c) * con.value, 3, `${con.name} amplifies the pattern`, a * b + c);
            tryEquation(`(${a} Ã— ${b}) Ã· (${c} Ã— ${con.symbol})`, (a * b) / (c * con.value), 3, `Double division with ${con.name}`, (a * b) / c);
            tryEquation(`âˆš(${a} Ã— ${b} Ã— ${c}) Ã— ${con.symbol}`, Math.cbrt(a * b * c) * con.value, 3, `Cube root times ${con.name}`, Math.cbrt(a * b * c));
            tryEquation(`(${a}Ã—${b} + ${b}Ã—${c} + ${a}Ã—${c}) Ã· ${con.symbol}`, (a*b + b*c + a*c) / con.value, 3, `Symmetric products over ${con.name}`, (a*b + b*c + a*c) / con.value);
          }

          // Complex equations
          tryEquation(`(${a} Ã— ${b}) Ã· ${c} Ã— Ï€`, (a * b / c) * PI, 3, 'Pi completes the equation', a * b / c);
          tryEquation(`(${a} + ${b} Ã— ${c}) Ã· Ï†`, (a + b * c) / PHI, 3, 'Golden Ratio divides the sum', (a + b * c) / PHI);
          tryEquation(`âˆš(${a}Â² + ${b}Â² + ${c}Â²)`, Math.sqrt(a*a + b*b + c*c), 3, '3D Pythagorean distance');
          tryEquation(`(${a} + ${b}) Ã— (${a} + ${c}) Ã· (${b} Ã— ${c})`, (a+b)*(a+c)/(b*c), 3, 'A symmetric dance');
        }
      }
    }
  }

  // Four-number relationships
  if (n >= 4) {
    for (let i = 0; i < n; i++) {
      for (let j = i + 1; j < n; j++) {
        for (let k = j + 1; k < n; k++) {
          for (let l = k + 1; l < n; l++) {
            const a = numbers[i], b = numbers[j], c = numbers[k], d = numbers[l];
            if (a === 0 || b === 0 || c === 0 || d === 0) continue;

            tryEquation(`${a} + ${b} + ${c} + ${d}`, a + b + c + d, 4, 'The quadrinity unites');
            tryEquation(`(${a} + ${b}) Ã— (${c} + ${d})`, (a + b) * (c + d), 4, 'Paired sums multiply');
            tryEquation(`(${a} Ã— ${b}) + (${c} Ã— ${d})`, (a * b) + (c * d), 4, 'Paired products combine');
            tryEquation(`(${a} Ã— ${b}) Ã· (${c} + ${d})`, (a * b) / (c + d), 4, 'Product over sum');
            tryEquation(`(${a} + ${b}) Ã· (${c} âˆ’ ${d})`, (a + b) / (c - d), 4, 'Sum over difference');
            tryEquation(`(${a} Ã— ${b} Ã— ${c}) Ã· ${d}`, (a * b * c) / d, 4, 'Triple product divided');
            tryEquation(`(${a} + ${b}) Ã— (${c} + ${d}) Ã· Ï€`, (a+b)*(c+d)/PI, 4, 'Paired product over Pi', (a+b)*(c+d)/PI);
            tryEquation(`(${a} Ã— ${b}) Ã· (${c} Ã— ${d}) Ã— Ï†`, (a*b)/(c*d)*PHI, 4, 'Ratio of products times Phi', (a*b)/(c*d));
            tryEquation(`(${a} + ${b} + ${c} + ${d}) Ã· Ï†`, (a + b + c + d) / PHI, 4, 'Total divided by Golden Ratio', (a + b + c + d) / PHI);
            tryEquation(`(${a} Ã— ${b} Ã— ${c} Ã— ${d}) Ã· Ï€Â²`, (a * b * c * d) / (PI * PI), 4, 'Quadruple product over Pi squared', (a * b * c * d) / (PI * PI));
            tryEquation(`âˆš(${a}Ã—${b}) + âˆš(${c}Ã—${d})`, Math.sqrt(a*b) + Math.sqrt(c*d), 4, 'Sum of geometric means');
            tryEquation(`(${a}Ã—${b} âˆ’ ${c}Ã—${d}) Ã— Ï†`, (a*b - c*d) * PHI, 4, 'Product difference times Phi', a*b - c*d);
          }
        }
      }
    }
  }

  // All numbers combined (if 3+)
  if (n >= 3) {
    const sum = numbers.reduce((a, b) => a + b, 0);
    const product = numbers.reduce((a, b) => a * b, 1);
    const sumStr = numbers.join(' + ');
    const prodStr = numbers.join(' Ã— ');

    tryEquation(`${sumStr}`, sum, n, 'All numbers unite');
    tryEquation(`${prodStr}`, product, n, 'All numbers multiply');
    tryEquation(`(${sumStr}) Ã· Ï€`, sum / PI, n, 'Total divided by Pi', sum / PI);
    tryEquation(`(${sumStr}) Ã· Ï†`, sum / PHI, n, 'Total divided by Phi', sum / PHI);
    tryEquation(`(${sumStr}) Ã— Ï† Ã· Ï€`, sum * PHI / PI, n, 'Phi over Pi scales the sum', sum * PHI / PI);
    tryEquation(`(${prodStr}) Ã· e`, product / E, n, "Euler's number divides the product", product / E);
    tryEquation(`âˆš(${sumStr})`, Math.sqrt(sum), n, 'Square root of total');
    tryEquation(`(${sumStr})Â² Ã· (${prodStr})`, (sum * sum) / product, n, 'Sum squared over product');

    // Average-based
    const avg = sum / n;
    tryEquation(`avg(${numbers.join(', ')}) Ã— ${n}`, avg * n, n, 'Average times count');
    tryEquation(`avg Ã— Ï€`, avg * PI, n, 'Average times Pi', avg);
    tryEquation(`avg Ã— Ï† Ã— e`, avg * PHI * E, n, 'Average times sacred constants', avg);
  }

  // Sort by numbers involved (descending), then by accuracy
  const seenEquations = new Set();
  const seenResults = new Set();
  const filtered = results
    .sort((a, b) => {
      if (b.numbersInvolved !== a.numbersInvolved) {
        return b.numbersInvolved - a.numbersInvolved;
      }
      return parseFloat(b.accuracy) - parseFloat(a.accuracy);
    })
    .filter(r => {
      // Skip if we've seen this exact equation
      const eqKey = `${r.equation}-${r.result}`;
      if (seenEquations.has(eqKey)) return false;
      seenEquations.add(eqKey);

      // Also skip if we've already found this result (same magic number)
      // Keep only the best (first, since sorted by accuracy) for each unique result
      const resultKey = `${r.resultName}-${r.numbersInvolved}`;
      if (seenResults.has(resultKey)) return false;
      seenResults.add(resultKey);

      return true;
    });

  // Split into multi-number (2+) and single-number results
  const multiNumber = filtered.filter(r => r.numbersInvolved >= 2).slice(0, 20);
  const singleNumber = filtered.filter(r => r.numbersInvolved === 1).slice(0, 15);

  return { multiNumber, singleNumber };
}

const CATEGORY_COLORS = {
  mathematical: 'from-blue-500 to-cyan-500',
  cosmic: 'from-purple-500 to-pink-500',
  ancient: 'from-amber-600 to-yellow-500',
  mystical: 'from-violet-500 to-purple-500',
  physics: 'from-green-500 to-teal-500',
  numerology: 'from-pink-500 to-rose-500',
  precessional: 'from-orange-500 to-red-500',
};

const MYSTERY_COLORS = {
  'ULTIMATE CONVERGENCE': 'bg-yellow-200 text-yellow-900 border-yellow-400 font-bold',
  TRANSCENDENT: 'bg-fuchsia-100 text-fuchsia-800 border-fuchsia-300',
  INCREDIBLE: 'bg-yellow-100 text-yellow-800 border-yellow-300',
  DISCOVERED: 'bg-purple-100 text-purple-800 border-purple-300',
  REMARKABLE: 'bg-purple-100 text-purple-800 border-purple-300',
  INTRIGUING: 'bg-blue-100 text-blue-800 border-blue-300',
  MYSTICAL: 'bg-pink-100 text-pink-800 border-pink-300',
  COSMIC: 'bg-indigo-100 text-indigo-800 border-indigo-300',
  HARMONIOUS: 'bg-green-100 text-green-800 border-green-300',
  SYNCHRONISTIC: 'bg-cyan-100 text-cyan-800 border-cyan-300',
};

// Reusable component for displaying a finding
function FindingCard({ finding, compact = false }) {
  const constants = findConstantsInEquation(finding.equation);

  return (
    <div
      className={`${compact ? 'p-2' : 'p-3'} rounded-xl bg-gradient-to-r ${CATEGORY_COLORS[finding.magic?.category] || 'from-gray-500 to-gray-600'} bg-opacity-10 border border-white/10`}
      style={{ background: `linear-gradient(135deg, rgba(255,255,255,0.07), rgba(255,255,255,0.02))` }}
    >
      <div className="flex items-start justify-between gap-2">
        <div className="flex-1 min-w-0">
          <div className="flex items-center gap-2 flex-wrap mb-2">
            <span className={compact ? 'text-base' : 'text-lg'}>{finding.magic?.symbol || 'âœ¨'}</span>
            <span className={`text-xs px-2 py-0.5 rounded-full border ${MYSTERY_COLORS[finding.mysteryLevel] || 'bg-purple-100 text-purple-800 border-purple-300'}`}>
              {finding.mysteryLevel}
            </span>
          </div>
          <p className={`text-purple-100 font-mono ${compact ? 'text-xs' : 'text-sm'} bg-slate-800/50 rounded-lg px-3 py-2 overflow-x-auto`}>
            {finding.equation} = <span className="text-yellow-300 font-bold">{finding.result}</span>
          </p>

          {/* Constant explanations - hide in compact mode */}
          {!compact && constants.length > 0 && (
            <div className="mt-2 space-y-1">
              {constants.map((c, i) => (
                <p key={i} className="text-purple-300/60 text-xs">
                  <span className="text-purple-200 font-mono">{c.symbol}</span> = {c.explanation}
                </p>
              ))}
            </div>
          )}

          <p className={`text-purple-300/80 ${compact ? 'text-xs' : 'text-sm'} mt-2`}>
            â†’ {finding.resultName || finding.result}
            {finding.magic?.value && (
              <span className="text-purple-400/60 ml-1">
                ({finding.magic.value.toLocaleString()})
              </span>
            )}
          </p>
          {!compact && (
            <p className="text-purple-400/50 text-xs mt-1 italic">
              {finding.magic?.description || finding.description}
            </p>
          )}
        </div>
        <div className="text-right flex-shrink-0">
          <div className={`text-green-400 font-bold ${compact ? 'text-base' : 'text-lg'}`}>{finding.accuracy}%</div>
          <div className="text-purple-400/50 text-xs">precision</div>
        </div>
      </div>
    </div>
  );
}

function App() {
  const [inputText, setInputText] = useState('');
  const [results, setResults] = useState(null);
  const [isSearching, setIsSearching] = useState(false);
  const [history, setHistory] = useState([]);
  const [showHistory, setShowHistory] = useState(false);

  useEffect(() => {
    setHistory(loadHistory());
  }, []);

  const loadFromHistory = (entry) => {
    setInputText(entry.numbers.join(', '));
    setShowHistory(false);
  };

  const handleDeleteHistory = (id, e) => {
    e.stopPropagation();
    deleteFromHistory(id);
    setHistory(loadHistory());
  };

  const handleSearch = () => {
    const numbers = inputText
      .split(/[\s,\n]+/)
      .map(s => parseFloat(s.trim()))
      .filter(n => !isNaN(n));

    if (numbers.length === 0) {
      alert('Please enter at least one number');
      return;
    }

    // Save to history
    saveToHistory(numbers);
    setHistory(loadHistory());

    setIsSearching(true);

    // Add dramatic delay for effect
    setTimeout(() => {
      const found = findMagic(numbers);
      setResults({ numbers, findings: found });
      setIsSearching(false);
    }, 1500);
  };

  const reset = () => {
    setResults(null);
    setInputText('');
  };

  return (
    <div className="h-full bg-gradient-to-br from-indigo-950 via-purple-950 to-slate-900 p-4 flex items-center justify-center overflow-auto stars">
      <a href="/my-tools/" className="absolute top-4 left-4 p-2 bg-white/10 hover:bg-white/20 rounded-full transition-colors">
        <svg className="w-5 h-5 text-purple-200" fill="none" viewBox="0 0 24 24" stroke="currentColor">
          <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6" />
        </svg>
      </a>
      <div className="w-full max-w-xl my-auto">

        {!results && !isSearching && (
          <div className="bg-slate-900/80 backdrop-blur-sm rounded-2xl shadow-2xl p-6 border border-purple-500/30">
            <div className="text-center mb-6">
              <span className="text-4xl floating inline-block">ðŸ”®</span>
              <h1 className="text-2xl font-bold text-transparent bg-clip-text bg-gradient-to-r from-purple-400 to-pink-400 mt-2">
                Magic Number Finder
              </h1>
              <p className="text-purple-300/70 text-sm mt-1">
                Discover hidden cosmic connections in any number
              </p>
            </div>

            <textarea
              value={inputText}
              onChange={(e) => setInputText(e.target.value)}
              placeholder={"Enter any numbers...\n\nExamples:\n432\n1776, 1969\n23, 42, 108"}
              className="w-full h-40 p-4 bg-slate-800/50 border border-purple-500/30 rounded-xl text-purple-100 placeholder-purple-400/50 focus:outline-none focus:ring-2 focus:ring-purple-500/50 resize-none"
            />

            <p className="text-purple-400/50 text-xs mt-2 text-center">
              Enter one or more numbers separated by spaces, commas, or new lines
            </p>

            {history.length > 0 && (
              <div className="mt-3">
                <button
                  onClick={() => setShowHistory(!showHistory)}
                  className="text-sm text-purple-400 hover:text-purple-300 flex items-center gap-1"
                >
                  {showHistory ? 'Hide' : 'Load'} previous numbers ({history.length})
                  <svg className={`w-4 h-4 transition-transform ${showHistory ? 'rotate-180' : ''}`} fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M19 9l-7 7-7-7" />
                  </svg>
                </button>
                {showHistory && (
                  <div className="mt-2 space-y-2 max-h-32 overflow-y-auto">
                    {history.map(entry => (
                      <div
                        key={entry.id}
                        onClick={() => loadFromHistory(entry)}
                        className="flex items-center justify-between p-2 bg-slate-800/50 hover:bg-purple-900/30 rounded-lg cursor-pointer group border border-purple-500/20"
                      >
                        <div className="flex-1 min-w-0">
                          <p className="text-sm text-purple-200 truncate font-mono">{entry.preview}</p>
                          <p className="text-xs text-purple-400/50">{entry.numbers.length} numbers Â· {entry.date}</p>
                        </div>
                        <button
                          onClick={(e) => handleDeleteHistory(entry.id, e)}
                          className="ml-2 p-2 min-w-[44px] min-h-[44px] flex items-center justify-center text-purple-400/70 hover:text-red-400 hover:bg-red-900/30 rounded-lg transition-colors"
                        >
                          <svg className="w-5 h-5" fill="none" viewBox="0 0 24 24" stroke="currentColor" strokeWidth={2.5}>
                            <path strokeLinecap="round" strokeLinejoin="round" d="M6 18L18 6M6 6l12 12" />
                          </svg>
                        </button>
                      </div>
                    ))}
                  </div>
                )}
              </div>
            )}

            <button
              onClick={handleSearch}
              className="w-full mt-4 py-3 bg-gradient-to-r from-purple-600 to-pink-600 hover:from-purple-500 hover:to-pink-500 text-white font-semibold rounded-xl transition-all shadow-lg shadow-purple-500/25"
            >
              Reveal the Mysteries âœ¨
            </button>
          </div>
        )}

        {isSearching && (
          <div className="bg-slate-900/80 backdrop-blur-sm rounded-2xl shadow-2xl p-8 border border-purple-500/30 text-center">
            <div className="text-6xl mb-4 floating">ðŸŒŒ</div>
            <p className="text-purple-300 text-lg">Consulting the cosmos...</p>
            <div className="mt-4 flex justify-center gap-1">
              {[0, 1, 2].map(i => (
                <div
                  key={i}
                  className="w-3 h-3 bg-purple-500 rounded-full animate-bounce"
                  style={{ animationDelay: `${i * 0.15}s` }}
                />
              ))}
            </div>
          </div>
        )}

        {results && (
          <div className="bg-slate-900/80 backdrop-blur-sm rounded-2xl shadow-2xl p-6 border border-purple-500/30 max-h-[85vh] overflow-auto">
            <div className="text-center mb-4">
              <span className="text-3xl">âœ¨</span>
              <h2 className="text-xl font-bold text-purple-200 mt-1">Mystical Discoveries</h2>
              <p className="text-purple-400/70 text-sm">
                Analyzing: {results.numbers.join(', ')}
              </p>
            </div>

            {results.findings.multiNumber.length === 0 && results.findings.singleNumber.length === 0 ? (
              <div className="text-center py-8 text-purple-400/70">
                <span className="text-4xl">ðŸ¤”</span>
                <p className="mt-2">The cosmos remains silent on these numbers...</p>
                <p className="text-sm mt-1">Try different values!</p>
              </div>
            ) : (
              <>
                {/* Multi-number results (prominent) */}
                {results.findings.multiNumber.length > 0 && (
                  <div className="space-y-3">
                    <h3 className="text-purple-300 text-sm font-medium flex items-center gap-2">
                      <span>ðŸ”—</span> Connections Between Your Numbers
                    </h3>
                    {results.findings.multiNumber.map((finding, idx) => (
                      <FindingCard key={`multi-${idx}`} finding={finding} />
                    ))}
                  </div>
                )}

                {/* Single-number results (collapsible) */}
                {results.findings.singleNumber.length > 0 && (
                  <details className="mt-4 group">
                    <summary className="cursor-pointer text-purple-400/70 text-sm hover:text-purple-300 flex items-center gap-2 py-2">
                      <svg className="w-4 h-4 transition-transform group-open:rotate-90" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M9 5l7 7-7 7" />
                      </svg>
                      <span>âœ¨ Individual Number Properties ({results.findings.singleNumber.length})</span>
                    </summary>
                    <div className="space-y-3 mt-3 pt-3 border-t border-purple-500/20">
                      {results.findings.singleNumber.map((finding, idx) => (
                        <FindingCard key={`single-${idx}`} finding={finding} compact />
                      ))}
                    </div>
                  </details>
                )}
              </>
            )}

            <button
              onClick={reset}
              className="w-full mt-4 py-3 bg-gradient-to-r from-purple-600 to-pink-600 hover:from-purple-500 hover:to-pink-500 text-white font-semibold rounded-xl transition-all"
            >
              Explore More Numbers
            </button>
          </div>
        )}
      </div>
    </div>
  );
}

ReactDOM.createRoot(document.getElementById('root')).render(<App />);
  </script>
</body>
</html>
